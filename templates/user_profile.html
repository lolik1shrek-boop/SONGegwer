{% extends "base.html" %}

{% block title %}{{ user.username }} — профиль{% endblock %}

{% block content %}
<div class="container">
  <div class="page-title">
    <h1>{{ user.username }} — профиль</h1>
    <p>Общедоступная страница пользователя</p>
  </div>

  <div style="max-width: 700px; margin: 0 auto; text-align: center;">
    {% if user.avatar_filename %}
      <img src="{{ url_for('static', filename='uploads/' + user.avatar_filename) }}" alt="avatar" style="width:160px; height:160px; border-radius:50%; object-fit:cover; margin-bottom:12px; border:1px solid rgba(255,255,255,0.04);">
    {% else %}
      <img src="{{ url_for('static', filename='icon_account.png') }}" alt="avatar" style="width:160px; height:160px; border-radius:50%; object-fit:cover; margin-bottom:12px;">
    {% endif %}

    <h2 style="margin-bottom:6px;">{{ user.username }}</h2>
    <p style="color:#999; margin-bottom:8px;">Зарегистрирован: {{ user.created_at.strftime('%d.%m.%Y') if user.created_at else '—' }}</p>

    <div style="display:flex; gap:12px; justify-content:center; margin-bottom:12px; color:#ddd; font-size:14px;">
      <div style="text-align:center;"><strong style="display:block; color:#fff; font-size:18px;">{{ user_tabs|length }}</strong><small>Табы</small></div>
      <div style="text-align:center;"><strong style="display:block; color:#fff; font-size:18px;">{{ favorites_count }}</strong><small>Избранное</small></div>
      <div style="text-align:center;"><strong style="display:block; color:#fff; font-size:18px;">{{ followers_count }}</strong><small>Подписчики</small></div>
      <div style="text-align:center;"><strong style="display:block; color:#fff; font-size:18px;">{{ following_count }}</strong><small>Подписок</small></div>
    </div>

    <div style="text-align:left; background:#111; padding:18px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); margin-bottom:18px;">
      <h3 style="margin-top:0; color:#E99FCF;">Публичные табы ({{ user_tabs|length }})</h3>
      {% if user_tabs %}
        <div class="grid">
          {% for tab in user_tabs %}
          <div class="card">
            <div class="card-body">
              <h3>{{ tab.title }}</h3>
              <p style="color:#999; margin-bottom:0;">{{ tab.artist }} • {{ tab.length_label }}</p>
            </div>
            <div class="card-actions">
              <a class="btn btn-view" href="{{ url_for('view_tab', id=tab.id) }}">View</a>
              {% if current_user and current_user.id == user.id %}
                <a class="btn btn-edit" href="{{ url_for('edit_tab', id=tab.id) }}">Edit</a>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <p style="color:#bbb;">Пользователь пока не добавил табы.</p>
      {% endif %}
    </div>

    <div style="display:flex; justify-content:center; gap:10px;">
      {% if current_user and current_user.id != user.id %}
        <form action="{{ url_for('toggle_follow', user_id=user.id) }}" method="POST" style="display:inline-block;">
          {# Use classes to control color: btn-follow + follow/following #}
          <button class="btn btn-follow {% if current_is_following %}following{% else %}follow{% endif %}" type="submit">
            {% if current_is_following %}Отписаться{% else %}Подписаться{% endif %}
          </button>
        </form>
      {% endif %}
      <a class="btn btn-view" href="{{ url_for('home') }}">На главную</a>
      {% if current_user and current_user.id == user.id %}
        <a class="btn btn-edit" href="{{ url_for('edit_profile') }}">Редактировать профиль</a>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
